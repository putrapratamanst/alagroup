var file_frame;jQuery(document).ready(function(e){function r(r,o){e.trim(r.val())||null===o||r.val(o)}e(".upload-image-button").on("click",function(r){return r.preventDefault(),file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({title:e(this).data("uploader_title"),button:{text:e(this).data("uploader_button_text")},multiple:!1}),file_frame.on("select",function(){attachment=file_frame.state().get("selection").first().toJSON(),e("#book_review_cover_url").val(attachment.url),e("#book_review_cover_image").attr("src",attachment.url).show()}),void file_frame.open())}),e("#book_review_cover_url").on("change",function(r){""!==e(this).val()?e("#book_review_cover_image").attr("src",e(this).val()).show():e("#book_review_cover_image").attr("src","").hide()}),e("#get-book-info").on("click",function(o){var t=null,a="",i="",n={action:"get_book_info",nonce:e("#ajax_isbn_nonce").text(),isbn:e("#book_review_isbn").val().replace(/-/g,"")};return e.trim(e("#book_review_isbn").val())?(e(".error-details").hide(),e("#book-review-meta-box .spinner").addClass("is-active"),e.post(ajaxurl,n,function(o){var n,s,l=0;e("#book-review-meta-box .spinner").removeClass("is-active");try{if(n=JSON.parse(o),n.hasOwnProperty("data")&&n.hasOwnProperty("status")&&"success"===n.status)if(s=JSON.parse(n.data),s.hasOwnProperty("items")&&s.items.constructor===Array&&s.items.length>0&&s.items[0].hasOwnProperty("volumeInfo")){if(t=s.items[0].volumeInfo,t.hasOwnProperty("title")&&r(e("#book_review_title"),t.title),t.hasOwnProperty("authors")&&t.authors.constructor===Array&&!e.trim(e("#book_review_author").val())){for(l=0;l<t.authors.length;l++)a+=t.authors[l],t.authors.length>1&&(a+=", ");e("#book_review_author").val(a)}if(t.hasOwnProperty("categories")&&t.categories.constructor===Array&&!e.trim(e("#book_review_genre").val())){for(l=0;l<t.categories.length;l++)i+=t.categories[l],t.categories.length>1&&(i+=", ");e("#book_review_genre").val(i)}if(t.hasOwnProperty("publisher")&&r(e("#book_review_publisher"),t.publisher),n.releaseDate&&r(e("#book_review_release_date"),n.releaseDate),t.hasOwnProperty("pageCount")&&r(e("#book_review_pages"),t.pageCount),t.hasOwnProperty("imageLinks")&&t.imageLinks.hasOwnProperty("thumbnail")&&!e.trim(e("#book_review_cover_url").val())&&(e("#book_review_cover_url").val(t.imageLinks.thumbnail),e("#book_review_cover_image").attr("src",t.imageLinks.thumbnail).show()),t.hasOwnProperty("description")&&"undefined"!=typeof tinymce){var _=tinymce.get("book_review_summary");_&&_ instanceof tinymce.Editor?e.trim(_.getContent())||(_.setContent(t.description),_.save({no_events:!0})):e.trim(e("textarea#book_review_summary").val())||e("textarea#book_review_summary").val(t.description)}}else e(".error-details").text(book_review_google_api.not_found).show(),console.log(s);else n.hasOwnProperty("status")&&"error"===n.status&&(e(".error-details").html(book_review_google_api.unknown_error).show(),n.hasOwnProperty("data")&&console.log("Error message: "+n.data))}catch(v){console.log("JSON parsing error: "+v)}})):e(".error-details").text(book_review_google_api.no_isbn).show(),!1})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb2stcmV2aWV3LW1ldGEtYm94LmpzIl0sIm5hbWVzIjpbImZpbGVfZnJhbWUiLCJqUXVlcnkiLCJkb2N1bWVudCIsInJlYWR5IiwiJCIsInNldEZpZWxkIiwiJGVsZW0iLCJ2YWx1ZSIsInRyaW0iLCJ2YWwiLCJvbiIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJvcGVuIiwid3AiLCJtZWRpYSIsImZyYW1lcyIsInRpdGxlIiwidGhpcyIsImRhdGEiLCJidXR0b24iLCJ0ZXh0IiwibXVsdGlwbGUiLCJhdHRhY2htZW50Iiwic3RhdGUiLCJnZXQiLCJmaXJzdCIsInRvSlNPTiIsInVybCIsImF0dHIiLCJzaG93IiwiaGlkZSIsInZvbHVtZSIsImF1dGhvciIsImdlbnJlIiwiYWN0aW9uIiwibm9uY2UiLCJpc2JuIiwicmVwbGFjZSIsImFkZENsYXNzIiwicG9zdCIsImFqYXh1cmwiLCJyZXNwb25zZSIsImpzb24iLCJpIiwicmVtb3ZlQ2xhc3MiLCJKU09OIiwicGFyc2UiLCJoYXNPd25Qcm9wZXJ0eSIsInN0YXR1cyIsIml0ZW1zIiwiY29uc3RydWN0b3IiLCJBcnJheSIsImxlbmd0aCIsInZvbHVtZUluZm8iLCJhdXRob3JzIiwiY2F0ZWdvcmllcyIsInB1Ymxpc2hlciIsInJlbGVhc2VEYXRlIiwicGFnZUNvdW50IiwiaW1hZ2VMaW5rcyIsInRodW1ibmFpbCIsInRpbnltY2UiLCJlZGl0b3IiLCJFZGl0b3IiLCJnZXRDb250ZW50Iiwic2V0Q29udGVudCIsImRlc2NyaXB0aW9uIiwic2F2ZSIsIm5vX2V2ZW50cyIsImJvb2tfcmV2aWV3X2dvb2dsZV9hcGkiLCJub3RfZm91bmQiLCJjb25zb2xlIiwibG9nIiwiaHRtbCIsInVua25vd25fZXJyb3IiLCJlIiwibm9faXNibiJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsV0FFSkMsUUFBT0MsVUFBVUMsTUFBTSxTQUFTQyxHQTJLOUIsUUFBU0MsR0FBU0MsRUFBT0MsR0FDbEJILEVBQUVJLEtBQUtG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QWUsY0FDeEIzQyxFQUFTRCxFQUFFLHNCQUF1QjRCLEVBQU8yQixXQUl2QzNCLEVBQU9nQixlQUFlLGVBQWlCaEIsRUFBTzRCLFdBQVdaLGVBQWUsZUFDekU1QyxFQUFFSSxLQUFLSixFQUFFLDBCQUEwQkssU0FDcENMLEVBQUUsMEJBQTBCSyxJQUFJdUIsRUFBTzRCLFdBQVdDLFdBQ2xEekQsRUFBRSw0QkFBNEJ5QixLQUFLLE1BQU9HLEVBQU80QixXQUFXQyxXQUFXL0IsUUFJckVFLEVBQU9nQixlQUFlLGdCQUNELG1CQUFaYyxTQUF5QixDQUNsQyxHQUFJQyxHQUFTRCxRQUFRckMsSUFBSSxzQkFFckJzQyxJQUFVQSxZQUFrQkQsU0FBUUUsT0FDakM1RCxFQUFFSSxLQUFLdUQsRUFBT0UsZ0JBQ2pCRixFQUFPRyxXQUFXbEMsRUFBT21DLGFBQ3pCSixFQUFPSyxNQUFPQyxXQUFXLEtBSXRCakUsRUFBRUksS0FBS0osRUFBRSxnQ0FBZ0NLLFFBQzVDTCxFQUFFLGdDQUFnQ0ssSUFBSXVCLEVBQU9tQyxrQkFPckQvRCxHQUFFLGtCQUFrQmlCLEtBQUtpRCx1QkFBdUJDLFdBQVd6QyxPQUMzRDBDLFFBQVFDLElBQUl0RCxPQUdQd0IsR0FBS0ssZUFBZSxXQUE4QixVQUFoQkwsRUFBS00sU0FDOUM3QyxFQUFFLGtCQUFrQnNFLEtBQUtKLHVCQUF1QkssZUFBZTdDLE9BRTNEYSxFQUFLSyxlQUFlLFNBQ3RCd0IsUUFBUUMsSUFBSSxrQkFBb0I5QixFQUFLeEIsT0FJM0MsTUFBT3lELEdBQ0xKLFFBQVFDLElBQUksdUJBQXlCRyxPQTlHekN4RSxFQUFFLGtCQUFrQmlCLEtBQUtpRCx1QkFBdUJPLFNBQVMvQyxRQW1IcEQiLCJmaWxlIjoiYm9vay1yZXZpZXctbWV0YS1ib3guanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZmlsZV9mcmFtZTtcblxualF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigkKSB7XG4gIC8vIFVwbG9hZGluZyBmaWxlc1xuICAkKFwiLnVwbG9hZC1pbWFnZS1idXR0b25cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAvLyBJZiB0aGUgbWVkaWEgZnJhbWUgYWxyZWFkeSBleGlzdHMsIHJlb3BlbiBpdC5cbiAgICBpZiAoZmlsZV9mcmFtZSkge1xuICAgICAgZmlsZV9mcmFtZS5vcGVuKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIHRoZSBtZWRpYSBmcmFtZS5cbiAgICBmaWxlX2ZyYW1lID0gd3AubWVkaWEuZnJhbWVzLmZpbGVfZnJhbWUgPSB3cC5tZWRpYSh7XG4gICAgICB0aXRsZTogJCh0aGlzKS5kYXRhKFwidXBsb2FkZXJfdGl0bGVcIiksXG4gICAgICBidXR0b246IHtcbiAgICAgICAgdGV4dDogJCh0aGlzKS5kYXRhKFwidXBsb2FkZXJfYnV0dG9uX3RleHRcIiksXG4gICAgICB9LFxuICAgICAgLy8gU2V0IHRvIHRydWUgdG8gYWxsb3cgbXVsdGlwbGUgZmlsZXMgdG8gYmUgc2VsZWN0ZWQuXG4gICAgICBtdWx0aXBsZTogZmFsc2VcbiAgICB9KTtcblxuICAgIC8vIFdoZW4gYW4gaW1hZ2UgaXMgc2VsZWN0ZWQsIHJ1biBhIGNhbGxiYWNrLlxuICAgIGZpbGVfZnJhbWUub24oXCJzZWxlY3RcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBhdHRhY2htZW50ID0gZmlsZV9mcmFtZS5zdGF0ZSgpLmdldChcInNlbGVjdGlvblwiKS5maXJzdCgpLnRvSlNPTigpO1xuICAgICAgJChcIiNib29rX3Jldmlld19jb3Zlcl91cmxcIikudmFsKGF0dGFjaG1lbnQudXJsKTtcbiAgICAgICQoXCIjYm9va19yZXZpZXdfY292ZXJfaW1hZ2VcIikuYXR0cihcInNyY1wiLCBhdHRhY2htZW50LnVybCkuc2hvdygpO1xuICAgIH0pO1xuXG4gICAgLy8gRmluYWxseSwgb3BlbiB0aGUgbW9kYWwuXG4gICAgZmlsZV9mcmFtZS5vcGVuKCk7XG4gIH0pO1xuXG4gICQoXCIjYm9va19yZXZpZXdfY292ZXJfdXJsXCIpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgaWYgKCQodGhpcykudmFsKCkgIT09IFwiXCIpIHtcbiAgICAgICQoXCIjYm9va19yZXZpZXdfY292ZXJfaW1hZ2VcIikuYXR0cihcInNyY1wiLCAkKHRoaXMpLnZhbCgpKS5zaG93KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJChcIiNib29rX3Jldmlld19jb3Zlcl9pbWFnZVwiKS5hdHRyKFwic3JjXCIsIFwiXCIpLmhpZGUoKTtcbiAgICB9XG4gIH0pO1xuXG4gICQoXCIjZ2V0LWJvb2staW5mb1wiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgdmFyIHZvbHVtZSA9IG51bGw7XG4gICAgdmFyIGF1dGhvciA9IFwiXCI7XG4gICAgdmFyIGdlbnJlID0gXCJcIjtcbiAgICB2YXIgZGF0YSA9IHtcbiAgICAgIGFjdGlvbjogXCJnZXRfYm9va19pbmZvXCIsXG4gICAgICBub25jZTogJChcIiNhamF4X2lzYm5fbm9uY2VcIikudGV4dCgpLFxuICAgICAgaXNibjogJChcIiNib29rX3Jldmlld19pc2JuXCIpLnZhbCgpLnJlcGxhY2UoLy0vZywgXCJcIilcbiAgICB9O1xuXG4gICAgaWYgKCEkLnRyaW0oJChcIiNib29rX3Jldmlld19pc2JuXCIpLnZhbCgpKSkge1xuICAgICAgJChcIi5lcnJvci1kZXRhaWxzXCIpLnRleHQoYm9va19yZXZpZXdfZ29vZ2xlX2FwaS5ub19pc2JuKS5zaG93KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJChcIi5lcnJvci1kZXRhaWxzXCIpLmhpZGUoKTtcbiAgICAgICQoXCIjYm9vay1yZXZpZXctbWV0YS1ib3ggLnNwaW5uZXJcIikuYWRkQ2xhc3MoXCJpcy1hY3RpdmVcIik7XG5cbiAgICAgICQucG9zdChhamF4dXJsLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICB2YXIganNvbiwgZGF0YSwgaSA9IDA7XG5cbiAgICAgICAgJChcIiNib29rLXJldmlldy1tZXRhLWJveCAuc3Bpbm5lclwiKS5yZW1vdmVDbGFzcyhcImlzLWFjdGl2ZVwiKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGpzb24gPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcblxuICAgICAgICAgIGlmIChqc29uLmhhc093blByb3BlcnR5KFwiZGF0YVwiKSAmJiBqc29uLmhhc093blByb3BlcnR5KFwic3RhdHVzXCIpICYmIChqc29uLnN0YXR1cyA9PT0gXCJzdWNjZXNzXCIpKSB7XG4gICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShqc29uLmRhdGEpO1xuXG4gICAgICAgICAgICAvLyBDaGVjayB0aGF0IGRhdGEgaGFzIGJlZW4gcmV0dXJuZWQuXG4gICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShcIml0ZW1zXCIpICYmIChkYXRhLml0ZW1zLmNvbnN0cnVjdG9yID09PSBBcnJheSkgJiZcbiAgICAgICAgICAgICAgKGRhdGEuaXRlbXMubGVuZ3RoID4gMCkgJiYgZGF0YS5pdGVtc1swXS5oYXNPd25Qcm9wZXJ0eShcInZvbHVtZUluZm9cIikpIHtcbiAgICAgICAgICAgICAgdm9sdW1lID0gZGF0YS5pdGVtc1swXS52b2x1bWVJbmZvO1xuXG4gICAgICAgICAgICAgIC8vIFRpdGxlXG4gICAgICAgICAgICAgIGlmICh2b2x1bWUuaGFzT3duUHJvcGVydHkoXCJ0aXRsZVwiKSkge1xuICAgICAgICAgICAgICAgIHNldEZpZWxkKCQoXCIjYm9va19yZXZpZXdfdGl0bGVcIiksIHZvbHVtZS50aXRsZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyBBdXRob3JcbiAgICAgICAgICAgICAgaWYgKHZvbHVtZS5oYXNPd25Qcm9wZXJ0eShcImF1dGhvcnNcIikgJiYgKHZvbHVtZS5hdXRob3JzLmNvbnN0cnVjdG9yID09PSBBcnJheSkgJiZcbiAgICAgICAgICAgICAgICAhJC50cmltKCQoXCIjYm9va19yZXZpZXdfYXV0aG9yXCIpLnZhbCgpKSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2b2x1bWUuYXV0aG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgYXV0aG9yICs9IHZvbHVtZS5hdXRob3JzW2ldO1xuXG4gICAgICAgICAgICAgICAgICBpZiAodm9sdW1lLmF1dGhvcnMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBhdXRob3IgKz0gXCIsIFwiO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQoXCIjYm9va19yZXZpZXdfYXV0aG9yXCIpLnZhbChhdXRob3IpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gR2VucmVcbiAgICAgICAgICAgICAgaWYgKHZvbHVtZS5oYXNPd25Qcm9wZXJ0eShcImNhdGVnb3JpZXNcIikgJiYgKHZvbHVtZS5jYXRlZ29yaWVzLmNvbnN0cnVjdG9yID09PSBBcnJheSkgJiZcbiAgICAgICAgICAgICAgICAhJC50cmltKCQoXCIjYm9va19yZXZpZXdfZ2VucmVcIikudmFsKCkpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHZvbHVtZS5jYXRlZ29yaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICBnZW5yZSArPSB2b2x1bWUuY2F0ZWdvcmllc1tpXTtcblxuICAgICAgICAgICAgICAgICAgaWYgKHZvbHVtZS5jYXRlZ29yaWVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2VucmUgKz0gXCIsIFwiO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQoXCIjYm9va19yZXZpZXdfZ2VucmVcIikudmFsKGdlbnJlKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIFB1Ymxpc2hlclxuICAgICAgICAgICAgICBpZiAodm9sdW1lLmhhc093blByb3BlcnR5KFwicHVibGlzaGVyXCIpKSB7XG4gICAgICAgICAgICAgICAgc2V0RmllbGQoJChcIiNib29rX3Jldmlld19wdWJsaXNoZXJcIiksIHZvbHVtZS5wdWJsaXNoZXIpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gUmVsZWFzZSBEYXRlXG4gICAgICAgICAgICAgIGlmIChqc29uLnJlbGVhc2VEYXRlKSB7XG4gICAgICAgICAgICAgICAgc2V0RmllbGQoJChcIiNib29rX3Jldmlld19yZWxlYXNlX2RhdGVcIiksIGpzb24ucmVsZWFzZURhdGUpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gUGFnZXNcbiAgICAgICAgICAgICAgaWYgKHZvbHVtZS5oYXNPd25Qcm9wZXJ0eShcInBhZ2VDb3VudFwiKSkge1xuICAgICAgICAgICAgICAgIHNldEZpZWxkKCQoXCIjYm9va19yZXZpZXdfcGFnZXNcIiksIHZvbHVtZS5wYWdlQ291bnQpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gQ292ZXIgVVJMXG4gICAgICAgICAgICAgIGlmICh2b2x1bWUuaGFzT3duUHJvcGVydHkoXCJpbWFnZUxpbmtzXCIpICYmIHZvbHVtZS5pbWFnZUxpbmtzLmhhc093blByb3BlcnR5KFwidGh1bWJuYWlsXCIpICYmXG4gICAgICAgICAgICAgICAgISQudHJpbSgkKFwiI2Jvb2tfcmV2aWV3X2NvdmVyX3VybFwiKS52YWwoKSkpIHtcbiAgICAgICAgICAgICAgICAkKFwiI2Jvb2tfcmV2aWV3X2NvdmVyX3VybFwiKS52YWwodm9sdW1lLmltYWdlTGlua3MudGh1bWJuYWlsKTtcbiAgICAgICAgICAgICAgICAkKFwiI2Jvb2tfcmV2aWV3X2NvdmVyX2ltYWdlXCIpLmF0dHIoXCJzcmNcIiwgdm9sdW1lLmltYWdlTGlua3MudGh1bWJuYWlsKS5zaG93KCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyBTeW5vcHNpc1xuICAgICAgICAgICAgICBpZiAodm9sdW1lLmhhc093blByb3BlcnR5KFwiZGVzY3JpcHRpb25cIikpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRpbnltY2UgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBlZGl0b3IgPSB0aW55bWNlLmdldChcImJvb2tfcmV2aWV3X3N1bW1hcnlcIik7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IgJiYgZWRpdG9yIGluc3RhbmNlb2YgdGlueW1jZS5FZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkLnRyaW0oZWRpdG9yLmdldENvbnRlbnQoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2V0Q29udGVudCh2b2x1bWUuZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5zYXZlKHsgbm9fZXZlbnRzOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkLnRyaW0oJChcInRleHRhcmVhI2Jvb2tfcmV2aWV3X3N1bW1hcnlcIikudmFsKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgJChcInRleHRhcmVhI2Jvb2tfcmV2aWV3X3N1bW1hcnlcIikudmFsKHZvbHVtZS5kZXNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAkKFwiLmVycm9yLWRldGFpbHNcIikudGV4dChib29rX3Jldmlld19nb29nbGVfYXBpLm5vdF9mb3VuZCkuc2hvdygpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiAoanNvbi5oYXNPd25Qcm9wZXJ0eShcInN0YXR1c1wiKSAmJiAoanNvbi5zdGF0dXMgPT09IFwiZXJyb3JcIikpIHtcbiAgICAgICAgICAgICQoXCIuZXJyb3ItZGV0YWlsc1wiKS5odG1sKGJvb2tfcmV2aWV3X2dvb2dsZV9hcGkudW5rbm93bl9lcnJvcikuc2hvdygpO1xuXG4gICAgICAgICAgICBpZiAoanNvbi5oYXNPd25Qcm9wZXJ0eShcImRhdGFcIikpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciBtZXNzYWdlOiBcIiArIGpzb24uZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJKU09OIHBhcnNpbmcgZXJyb3I6IFwiICsgZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG5cbiAgLy8gUG9wdWxhdGUgZmllbGQgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBjb250YWluIGEgdmFsdWUuXG4gIGZ1bmN0aW9uIHNldEZpZWxkKCRlbGVtLCB2YWx1ZSkge1xuICAgIGlmICghJC50cmltKCRlbGVtLnZhbCgpKSAmJiAodmFsdWUgIT09IG51bGwpKSB7XG4gICAgICAkZWxlbS52YWwodmFsdWUpO1xuICAgIH1cbiAgfVxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
